CREATE SCHEMA BIRD;

CREATE TABLE BIRD.AUTHOR
(ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
LASTNAME VARCHAR(255) NOT NULL,
FIRSTNAME VARCHAR(255),
BORN_LASTNAME VARCHAR(255),
BORN_FIRSTNAME VARCHAR(255),
IMAGE VARCHAR(500),
BIOGRAPHY CLOB(100000000),
COMMENT VARCHAR(500),
BORNDATE DATE,
CREATEDATE DATE,
PRIMARY KEY (ID));

CREATE TABLE BIRD.CYCLE
(ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
TITLE VARCHAR(500) NOT NULL,
CYCLE BOOLEAN,
NBRVOLUME SMALLINT NOT NULL,
COMMENT VARCHAR(500),
CREATIONDATE DATE,
BOOK_ID INTEGER NOT NULL,
PRIMARY KEY (ID));

CREATE TABLE BIRD.LINK_AUTHOR_CYCLE
(ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
ID_AUTHOR INTEGER NOT NULL,
ID_CYCLE INTEGER NOT NULL,
PRIMARY KEY (ID));

CREATE TABLE BIRD.BOOK
(ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
TITLE VARCHAR(500) NOT NULL,
STYLE_ID INTEGER NOT NULL,
PRESENTATION CLOB,
COVER VARCHAR(500),
EDITOR VARCHAR(255),
COLLECTION VARCHAR(255),
ISBN VARCHAR(100),
CREATIONDATE DATE,
PRIMARY KEY (ID));

CREATE TABLE BIRD.SYSTEM
(ID INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
"KEY" VARCHAR(100) NOT NULL,
VALUE VARCHAR(255) NOT NULL,
ENABLED BOOLEAN,
PRIMARY KEY (ID));

ALTER TABLE BIRD.LINK_AUTHOR_CYCLE
ADD FOREIGN KEY (ID_AUTHOR) 
REFERENCES BIRD.AUTHOR(ID);

ALTER TABLE BIRD.LINK_AUTHOR_CYCLE
ADD FOREIGN KEY (ID_CYCLE) 
REFERENCES BIRD.CYCLE(ID);

ALTER TABLE BIRD.CYCLE
ADD FOREIGN KEY (BOOK_ID) 
REFERENCES BIRD.BOOK(ID);

ALTER TABLE BIRD.BOOK
ADD FOREIGN KEY (STYLE_ID) 
REFERENCES BIRD.SYSTEM(ID);

CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.connection.requireAuthentication','true');
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.authentication.provider', 'BUILTIN');
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.user.root', 'Garion01');
CALL SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.propertiesOnly', 'true');